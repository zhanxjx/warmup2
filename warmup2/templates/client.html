<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>CS 169 Login Counter</title>
	<link rel="stylesheet" href="css/client.css">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<!-- This is all the page independent functions.  The ones which directly interact with the page are inlined below. -->
	<script type="text/javascript" src="client.js"></script>
	<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>
	<div id="login-page" class="login">
		<div id="login-message" class="message"></div>
		<form>
			<input id="login-username" type="text" class="login-input" placeholder="Username" autofocus>
			<input id="login-password" type="password" class="login-input" placeholder="Password">
			<input id="login-button" type="submit" value="Login" class="login-submit">
			<input id="add-user-button" type="submit" value="Add User" class="login-submit">
		</form>
	</div>
	
	<div id="welcome-page" class="login">
	  <div id="welcome-message" class="message"></div>
	  <center>
	    <form>
	      <input id="logout-button" type="submit" value="Logout" class="logout">
	    </form>
	  </center>
	</div>
	
	<footer>
		Copyright &copy; 1991-2013 Xingjian Zhan, University of California Berkeley
		<table class="center">
			<tr>
				<td><a href="http://www.facebook.com/zhanxj" target="_blank"><img src="images/Facebook.png" height="50" width="50"></a></td>
				<td><a href="http://www.linkedin.com/in/zhanxj" target="_blank"><img src="images/LinkedIn.png" height="50" width="50"></a></td>
				<td><a href="http://www.twitter.com/zhanxj" target="_blank"><img src="images/Twitter.png" height="50" width="50"></a></td>
				<td><a href="http://www.Gplus.to/zhanxj" target="_blank"><img src="images/G+.png" height="50" width="50"></a></td>
				<td><a href="http://www.renren.com/zhanxj" target="_blank"><img src="images/Renren.png" height="50" width="50" /></a></td>
				<td><a href="http://sighttp.qq.com/authd?IDKEY=7a7d38e87212065200b66f97c509436d7c3f0303c2b990cd" target="_blank"><img border="0"  src="images/QQ.png"  height="50" width="50"></a></td>
			</tr>
		</table>
	</footer>
	
	<script type="text/javascript">
	<!--
	/* Put the page into a blank state until everything finishes loading
	   This is not the ideal thing to do, but better than nothing. */
	$('#login-page').hide()
	$('#welcome-page').hide()
	$('#login-username').val("")
	$('#login-password').val("")
	$('#login-message').html("Please enter your credentials below")
	$('#welcome-message').html("You should never see this text");

	/* setup the page so that only one of the forms is shown */
	$(document).ready(function() {
	   show_login_page();
	 });

	/* Note: These two functions are deliberately written to ignore the starting
	   state.  This makes them slightly slower, but has the side effect of 
	   restoring any invariant that gets accidentally broken.*/
	function show_login_page(message) {
	  if(! message) message = "Please enter your credentials below";
	  $('#welcome-page').hide()
	  $('#login-username').val("")
	  $('#login-password').val("")
	  $('#login-message').html(message)
	  $('#login-page').show()
	}

	function show_welcome_page(user, count) {
	   $('#login-page').hide();
	   $('#welcome-page').show();
	   $('#welcome-message').html("<p>Welcome "+user+"</p><p>You have logged in "+count+" times.</p>");
	}

	function handle_login_response(data, user) {
	  if( data.errCode > 0 ) {
	     c = data.count;
	     show_welcome_page(user, c);
	  } else {
	     if( debug_flag ) {
	        if( data.errCode != ERR_BAD_CREDENTIALS ) {
	           alert( 'Illegal error code encounted for this state');
	        }
	     }
	     show_login_page( get_message_for_errcode(data.errCode) );  
	  }
	}

	function handle_add_user_response(data, user) {
	  if( data.errCode > 0 ) {
	     c = data.count;
	     show_welcome_page(user, c);
	  } else {
	     if( debug_flag ) {
	        if( data.errCode != ERR_BAD_USERNAME && data.errCode != ERR_USER_EXISTS ) {
	           alert( 'Illegal error code encounted for this state');
	        }
	     }
	     show_login_page( get_message_for_errcode(data.errCode) );  
	  }
	}

	$('#login-button').click(function() {
	   username = $('#login-username').val()
	   password = $('#login-password').val()
	   json_request("/users/login", { user: username, password: password }, function(data) { return handle_login_response(data, username); }, function(err) { alert('error occurred on request'); });

	   return false;
	});

	$('#add-user-button').click(function() {
	   username = $('#login-username').val()
	   password = $('#login-password').val()
	   json_request("/users/add", { user: username, password: password }, function(data) { return handle_add_user_response(data, username); }, function(err) {alert('error occurred on request'); });

	   return false;
	});

	$('#logout-button').click(function() {
	  show_login_page();

	  return false;
	});
	-->
	</script>
</body>
</html>
