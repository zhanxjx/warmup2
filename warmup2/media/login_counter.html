<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>CS 169 Login Counter</title>
	<link rel="stylesheet" href="css/login_counter.css">
	<link rel="shortcut icon" href="images/favicon.ico">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<!-- This is all the page independent functions.  The ones which directly interact with the page are inlined below. -->
	<script type="text/javascript" src="login_counter.js"></script>
	<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
</head>
<body>
	<div id="login-page" class="login">
		<div id="login-message" class="message"></div>
		<form>
			<input id="login-username" type="text" class="login-input" placeholder="Username" autofocus>
			<input id="login-password" type="password" class="login-input" placeholder="Password">
			<button id="login-button" class="submit button" type="button">Login</button>
			<button id="add-user-button" class="submit button" type="button">Sign Up</button>
		</form>
	</div>
	
	<div id="welcome-popup" class="welcome-popup">
	  <div id="welcome-message" class="message"></div>
	  <center>
	    <form method="post" action="#">
				<button id="logout-button" class="submit button" type="button">Logout</button>
	    </form>
	  </center>
	</div>
	
	<footer>
		Copyright &copy; 1991-2013 Xingjian Zhan, University of California Berkeley
		<table class="center">
			<tr>
				<td><a href="http://www.facebook.com/zhanxj" target="_blank"><img src="images/Facebook.png" height="50" width="50"></a></td>
				<td><a href="http://www.linkedin.com/in/zhanxj" target="_blank"><img src="images/LinkedIn.png" height="50" width="50"></a></td>
				<td><a href="http://www.twitter.com/zhanxj" target="_blank"><img src="images/Twitter.png" height="50" width="50"></a></td>
				<td><a href="http://www.Gplus.to/zhanxj" target="_blank"><img src="images/G+.png" height="50" width="50"></a></td>
				<td><a href="http://www.renren.com/zhanxj" target="_blank"><img src="images/Renren.png" height="50" width="50" /></a></td>
				<td><a href="http://sighttp.qq.com/authd?IDKEY=7a7d38e87212065200b66f97c509436d7c3f0303c2b990cd" target="_blank"><img border="0"  src="images/QQ.png"  height="50" width="50"></a></td>
			</tr>
		</table>
	</footer>
	
	<script>
		$(document).ready(function() {
			$('#login-message').html("Please enter your credentials below");
			popup_welcome();
		});

		function handle_login_response(data, user) {
		  if( data.errCode > 0 ) {
		     c = data.count;
		     popup_welcome(user, c);
		  } else {
		     $('#login-message').html(get_message_for_errcode(data.errCode));  
		  }
		}

		function handle_add_user_response(data, user) {
		  if( data.errCode > 0 ) {
		     c = data.count;
		     popup_welcome(user, c);
		  } else {
		     $('#login-message').html(get_message_for_errcode(data.errCode)); 
		  }
		}

		$('#login-button').click(function() {
		   username = $('#login-username').val()
		   password = $('#login-password').val()
		   json_request("/users/login", { user: username, password: password }, function(data) { return handle_login_response(data, username); }, function(err) { alert('error occurred on request'); });

		   return false;
		});

		$('#add-user-button').click(function() {
		   username = $('#login-username').val()
		   password = $('#login-password').val()
		   json_request("/users/add", { user: username, password: password }, function(data) { return handle_add_user_response(data, username); }, function(err) {alert('error occurred on request'); });

		   return false;
		});
		
		function popup_welcome(user, count) {
			//Getting the variable's value from a link 
			var loginBox = '#welcome-popup'

			//Fade in the Popup
			$(loginBox).fadeIn(300);
		
			//Set the center alignment padding + border see css style
			var popMargTop = ($(loginBox).height() + 24) / 2; 
			var popMargLeft = ($(loginBox).width() + 24) / 2; 
		
			$(loginBox).css({ 
				'margin-top' : -popMargTop,
				'margin-left' : -popMargLeft
			});
		
			// Add the mask to body
			$('body').append('<div id="mask"></div>');
			$('#mask').fadeIn(300);
			
			$('#welcome-message').html("<p>Welcome "+user+"</p><p>You have logged in "+count+" times.</p>");
		
			return false;
		}
		
		$('#logout-button').click(function() {
			$('#mask , #welcome-popup').fadeOut(300 , function() {
				$('#mask').remove();  
			}); 
			return false;
		});
	</script>
</body>
</html>
